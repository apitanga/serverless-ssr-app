# Serverless SSR App

A Nuxt.js application template for serverless SSR deployment on AWS Lambda + CloudFront.

## Features

- **Server-Side Rendering (SSR)** with Nuxt 3
- **API Routes** with Nitro engine
- **Multi-region deployment** support
- **DynamoDB integration** for data persistence
- **Static asset optimization** via CloudFront
- **Health checks** and monitoring endpoints

## Quick Start

### Prerequisites

1. **Infrastructure deployed** from [serverless-ssr-infra](https://github.com/apitanga/serverless-ssr-pattern/tree/modularize-infra)
2. AWS CLI configured with credentials
3. Node.js 20+

### Setup

```bash
# 1. Clone this template
git clone https://github.com/apitanga/serverless-ssr-app.git my-app
cd my-app

# 2. Install dependencies
npm install

# 3. Copy infrastructure outputs
# From your infra deployment directory:
terraform output -json > ~/my-app/config/infra-outputs.json

# 4. Deploy
./scripts/deploy.sh
```

## Development

```bash
# Start development server
npm run dev

# Build for production
npm run build

# Build for AWS Lambda
npm run build:lambda
```

## Project Structure

```
.
├── app/
│   ├── assets/            # Static assets (CSS, images)
│   ├── layouts/           # Vue layouts
│   ├── pages/             # Vue pages (file-based routing)
│   │   ├── index.vue      # Homepage with SSR counter
│   │   └── about.vue      # About page
│   ├── server/
│   │   └── api/           # API routes
│   │       ├── health.get.ts     # Health check endpoint
│   │       ├── counter.post.ts   # Visit counter API
│   │       ├── dashboard.get.ts  # Dashboard data
│   │       └── weather.get.ts    # Weather demo API
│   ├── nuxt.config.ts     # Nuxt configuration
│   └── package.json       # Dependencies
├── config/
│   └── infra-outputs.json # Terraform outputs (gitignored)
├── scripts/
│   └── deploy.sh          # Deployment script
└── .github/workflows/
    ├── ci.yml             # PR checks
    └── deploy.yml         # Deploy to AWS
```

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/health` | GET | Health check |
| `/api/counter` | POST | Increment visit counter |
| `/api/dashboard` | GET | Get dashboard data |
| `/api/weather` | GET | Sample weather API |

## Deployment

### Local Deployment

```bash
# Ensure AWS credentials are set
export AWS_PROFILE=pitanga

# Run deployment
./scripts/deploy.sh
```

### CI/CD (GitHub Actions)

1. Add GitHub secrets:
   - `AWS_ACCESS_KEY_ID`
   - `AWS_SECRET_ACCESS_KEY`
   - `AWS_PRIMARY_REGION`
   - `INFRA_OUTPUTS_JSON` (contents of `infra-outputs.json`)

2. Push to `main` branch triggers automatic deployment

## Configuration

The app reads infrastructure configuration from `config/infra-outputs.json`. This file is generated by Terraform and contains:

- Lambda function names
- S3 bucket names
- CloudFront distribution ID
- DynamoDB table name

## Documentation

- [Infrastructure Setup](docs/infrastructure-setup.md)
- [Deployment Guide](docs/deployment.md)

## License

MIT
